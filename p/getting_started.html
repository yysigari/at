
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>pyAT &#8212; Accelerator Toolbox 0.0.4 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom_at.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'p/getting_started';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="howto/Installation.html" />
    <link rel="prev" title="Welcome to pyAT’s documentation!" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/AT.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/AT.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Python
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../m/index.html">
                        Matlab
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../pabout.html">
                        About
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/atcollab/at" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Python
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../m/index.html">
                        Matlab
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../pabout.html">
                        About
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/atcollab/at" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">pyAT</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How to:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="howto/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/multiprocessing.html">Parallel processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/Primer.html">PyAT Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/CavityControl.html">Cavity Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/Collective.html">Collective</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Packages:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.acceptance.html">at.acceptance</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.acceptance.acceptance.html">at.acceptance.acceptance</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.acceptance.boundary.html">at.acceptance.boundary</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.acceptance.touschek.html">at.acceptance.touschek</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.collective.html">at.collective</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.collective.beam_loading.html">at.collective.beam_loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.collective.haissinski.html">at.collective.haissinski</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.collective.wake_elements.html">at.collective.wake_elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.collective.wake_functions.html">at.collective.wake_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.collective.wake_object.html">at.collective.wake_object</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.lattice.html">at.lattice</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.axisdef.html">at.lattice.axisdef</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.cavity_access.html">at.lattice.cavity_access</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.deprecated.html">at.lattice.deprecated</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.elements.html">at.lattice.elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.idtable_element.html">at.lattice.idtable_element</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.lattice_object.html">at.lattice.lattice_object</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.options.html">at.lattice.options</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.particle_object.html">at.lattice.particle_object</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.utils.html">at.lattice.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.lattice.variable_elements.html">at.lattice.variable_elements</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.load.html">at.load</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.load.allfiles.html">at.load.allfiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.load.elegant.html">at.load.elegant</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.load.matfile.html">at.load.matfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.load.reprfile.html">at.load.reprfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.load.tracy.html">at.load.tracy</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.load.utils.html">at.load.utils</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.matching.html">at.matching</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.matching.globalfit.html">at.matching.globalfit</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.matching.matching.html">at.matching.matching</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.physics.html">at.physics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.amat.html">at.physics.amat</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.diffmatrix.html">at.physics.diffmatrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.energy_loss.html">at.physics.energy_loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.fastring.html">at.physics.fastring</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.frequency_maps.html">at.physics.frequency_maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.harmonic_analysis.html">at.physics.harmonic_analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.linear.html">at.physics.linear</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.matrix.html">at.physics.matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.nonlinear.html">at.physics.nonlinear</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.orbit.html">at.physics.orbit</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.radiation.html">at.physics.radiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.revolution.html">at.physics.revolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.physics.ring_parameters.html">at.physics.ring_parameters</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.plot.html">at.plot</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.plot.generic.html">at.plot.generic</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.plot.specific.html">at.plot.specific</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.plot.standalone.html">at.plot.standalone</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.plot.synopt.html">at.plot.synopt</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/at.tracking.html">at.tracking</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/at.tracking.atpass.html">at.tracking.atpass</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.tracking.deprecated.html">at.tracking.deprecated</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.tracking.particles.html">at.tracking.particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.tracking.track.html">at.tracking.track</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/at.tracking.utils.html">at.tracking.utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/at.constants.html">at.constants</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="pyat">
<h1>pyAT<a class="headerlink" href="#pyat" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>Accelerator Toolbox is a code used for simulating particle accelerators, used
particularly for synchrotron light sources. It is hosted on <a class="reference external" href="https://github.com/atcollab/at">Github</a>. Its original implementation is in Matlab.</p>
<p>pyAT is a Python interface to Accelerator Toolbox. It uses the ‘pass methods’
defined in Accelerator Toolbox, implemented by compiling the C code used in the
AT ‘integrators’ into a Python extension. These pass methods are used by
higher-level functions to provide physics results.</p>
<p>See the <a class="reference external" href="https://atcollab.github.io/at/p/index.html">pyAT website</a> for a
more detailed introduction.</p>
<p>pyAT supports Python 3.7 to 3.11.</p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">#</a></h2>
<p>Install accelerator-toolbox from PyPI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install accelerator-toolbox
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">#</a></h2>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">at</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ring</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">Lattice</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;machine_data/hmba.mat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">radiation_parameters</span><span class="p">(</span><span class="n">ring</span><span class="p">))</span>
<span class="go">          Frac. tunes: [0.2099983  0.34001317 0.00349013]</span>
<span class="go">                Tunes: [76.2099983  27.34001317]</span>
<span class="go">       Chromaticities: [5.73409894 3.91761206]</span>
<span class="go">Momentum compact. factor: 8.506669e-05</span>
<span class="go">          Slip factor: -8.505944e-05</span>
<span class="go">               Energy: 6.000000e+09 eV</span>
<span class="go">   Energy loss / turn: 2.526189e+06 eV</span>
<span class="go">Radiation integrals - I1: 0.07179435013387388 m</span>
<span class="go">                   I2: 0.13844595446798158 m^-1</span>
<span class="go">                   I3: 0.003357584058614851 m^-2</span>
<span class="go">                   I4: -0.07375725030666251 m^-1</span>
<span class="go">                   I5: 5.281495714523264e-07 m^-1</span>
<span class="go">      Mode emittances: [1.3148797e-10           nan           nan]</span>
<span class="go">Damping partition numbers: [1.53275121 1.         1.46724879]</span>
<span class="go">        Damping times: [0.00872477 0.0133729  0.00911427] s</span>
<span class="go">        Energy spread: 0.000934463</span>
<span class="go">         Bunch length: 0.0030591 m</span>
<span class="go">     Cavities voltage: 6000000.0 V</span>
<span class="go">    Synchrotron phase: 2.70701 rd</span>
<span class="go">Synchrotron frequency: 1239.74 Hz</span>
</pre></div>
</div>
<p>For more examples of how to use pyAT, see <code class="docutils literal notranslate"><span class="pre">pyat_examples.rst</span></code>.</p>
</section>
<section id="developer-notes">
<h2>Developer Notes<a class="headerlink" href="#developer-notes" title="Permalink to this heading">#</a></h2>
<p>Developer notes are in <code class="docutils literal notranslate"><span class="pre">developers.rst</span></code>.</p>
</section>
</section>
<section id="pyat-developer-notes">
<h1>pyAT Developer Notes<a class="headerlink" href="#pyat-developer-notes" title="Permalink to this heading">#</a></h1>
<p>See also README.rst.</p>
<section id="installation-preparation">
<h2>Installation preparation<a class="headerlink" href="#installation-preparation" title="Permalink to this heading">#</a></h2>
<section id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this heading">#</a></h3>
<p>Download the appropriate version of Visual C++.</p>
</section>
<section id="linux">
<h3>Linux<a class="headerlink" href="#linux" title="Permalink to this heading">#</a></h3>
<p>Install the Python development package for your OS. For example, using yum:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo yum install python3-devel
</pre></div>
</div>
</section>
</section>
<section id="source-download">
<h2>Source download<a class="headerlink" href="#source-download" title="Permalink to this heading">#</a></h2>
<p>Download the latest version of AT:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/atcollab/at.git
</pre></div>
</div>
</section>
<section id="installation-all-platforms">
<h2>Installation (all platforms)<a class="headerlink" href="#installation-all-platforms" title="Permalink to this heading">#</a></h2>
<p>All the binaries should be built when building the Python extension.</p>
<p>It is easiest to do this using a virtualenv. inside pyat:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -m venv venv
</pre></div>
</div>
<p>Then:</p>
<ul>
<li><p>activate the virtual environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source venv/bin/activate  # or venv\Scripts\activate on Windows
</pre></div>
</div>
</li>
<li><p>make sure you have a recent pip installer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install --upgrade pip
</pre></div>
</div>
</li>
<li><p>Go to the AT root directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">atroot</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>install AT, with the developer tools.
2 option sets are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[dev]</span></code> installs test modules (<code class="docutils literal notranslate"><span class="pre">pytest</span></code>,…)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[doc]</span></code> installs documentation tools (<code class="docutils literal notranslate"><span class="pre">sphinx</span></code> and extensions)</p></li>
</ul>
<p>They can be installed together: [dev, doc]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install -e &quot;.[dev]&quot;
</pre></div>
</div>
</li>
</ul>
<p>Finally, you should be able to run the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m pytest pyat/test
</pre></div>
</div>
</section>
<section id="comparing-results-with-matlab">
<h2>Comparing results with Matlab<a class="headerlink" href="#comparing-results-with-matlab" title="Permalink to this heading">#</a></h2>
<p>There is a second set of tests that require a Matlab licence and allows
comparing results directly with a Matlab session.  See test_matlab/README
for information.</p>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading">#</a></h2>
<p>Print statements in the C code will work once the integrators are
recompiled.  To force recompilation, remove the build directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm -rf build
</pre></div>
</div>
<p>Any changes to .py files are automatically reinstalled in the build, but to
ensure any changes to .c files are reinstalled rerun:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install -e .
</pre></div>
</div>
<p>If you get strange behaviour even after running pip install develop again, then
running the following, inside pyat, should fix it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm -rf build
$ find at -name &quot;*.pyc&quot; -exec rm &#39;{}&#39; \;
$ find at -name &quot;*.so&quot; -exec rm &#39;{}&#39; \;
$ pip install -e .
</pre></div>
</div>
<p>N.B. <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> needs to be run with the same version of Python (and
numpy) that you are using to run pyAT.</p>
</section>
<section id="releasing-a-version-to-pypi">
<h2>Releasing a version to PyPI<a class="headerlink" href="#releasing-a-version-to-pypi" title="Permalink to this heading">#</a></h2>
<p>Because pyAT compiles C code, releasing a version is not simple. The code
must be compiled for different operating systems and Python versions.</p>
<p>To do this, we use the continuous integration service Github Actions.
When a tag of the form pyat-* is pushed to Github, wheels for each
supported platform will be built and automatically uploaded as an ‘artifact’.</p>
<p>We use <a class="reference external" href="https://semver.org/">Semantic Versioning</a> for this project. As documented
by the full specification, we use a version number with three dot-separated
numbers: <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code>. Increment the:</p>
<ul class="simple">
<li><p>MAJOR version when you make incompatible API changes</p></li>
<li><p>MINOR version when you add functionality in a backward compatible manner</p></li>
<li><p>PATCH version when you make backward compatible bug fixes</p></li>
</ul>
</section>
<section id="release-procedure">
<h2>Release procedure<a class="headerlink" href="#release-procedure" title="Permalink to this heading">#</a></h2>
<p>To upload a release to PyPI, you will need to be a ‘maintainer’ of
<a class="reference external" href="https://pypi.org/project/accelerator-toolbox/">Accelerator Toolbox on PyPI</a>.</p>
<p>For testing any version that you have installed, the simple snippet in
<code class="docutils literal notranslate"><span class="pre">README.rst</span></code> is sufficient.</p>
<section id="decide-the-python-versions-that-should-be-supported-in-the-release">
<h3>Decide the Python versions that should be supported in the release<a class="headerlink" href="#decide-the-python-versions-that-should-be-supported-in-the-release" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Set these Python versions in <code class="docutils literal notranslate"><span class="pre">requires-python</span></code> in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></p></li>
<li><p>Set at least these Python versions as <code class="docutils literal notranslate"><span class="pre">python-version</span></code> in <code class="docutils literal notranslate"><span class="pre">.github/workflows/python-tests.yml</span></code></p></li>
</ul>
</section>
<section id="determine-the-minimum-numpy-and-scipy-versions">
<h3>Determine the minimum <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code> versions:<a class="headerlink" href="#determine-the-minimum-numpy-and-scipy-versions" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>the version ensuring the requirements necessary to <strong>run</strong> PyAT is set in the
<code class="docutils literal notranslate"><span class="pre">dependencies</span></code> item of the <code class="docutils literal notranslate"><span class="pre">[project]</span></code> section of <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></p></li>
<li><p>The version required to <strong>build</strong> PyAT is set in the <code class="docutils literal notranslate"><span class="pre">requires</span></code> item of the
<code class="docutils literal notranslate"><span class="pre">[build-system]</span></code> section of <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. It depends on the python version
and must be higher or equal to the “run” version.</p></li>
<li><p>To avoid ABI compatibility issues, the pre-compiled binaries are built with the
earliest possible version of numpy for the given Python version. This ensures that
the user’s libraries are more recent than the one AT has been compiled with. For
that, a copy of <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> named <code class="docutils literal notranslate"><span class="pre">githubproject.toml</span></code> is used for
compilation. In this copy, the numpy version specifications are set using <code class="docutils literal notranslate"><span class="pre">~=</span></code>
instead of minimum (<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>). Apart from these lines, the 2 files
should be strictly identical.</p></li>
</ul>
</section>
<section id="prepare-the-release-notes">
<h3>Prepare the “Release notes”<a class="headerlink" href="#prepare-the-release-notes" title="Permalink to this heading">#</a></h3>
<p>A draft can be obtained by creating a new tag on GitHub. Click “Draft a new release”
in the releases page, choose a new tag in the form <code class="docutils literal notranslate"><span class="pre">pyat-x.y.z</span></code> with the correct
incremented version number. The <code class="docutils literal notranslate"><span class="pre">pyat-</span></code> prefix is necessary to identify python releases.
Select the master branch as target. In the description area, choose the current
release in the “previous tag” pull-down, and press “Generate release notes”.</p>
<p>The generated notes can now be copied and edited. You can then either cancel or
save the release as a draft while editing the release notes.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">What's</span> <span class="pre">changed</span></code> section should be split into <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Bug</span> <span class="pre">fixes</span></code> and
<code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">New</span> <span class="pre">features</span></code>. It must be filtered to keep only the python changes, ignoring
the Matlab ones. The tags on each pull request are there to help in this filtering.</p>
<p>The release notes should start with a <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Main</span> <span class="pre">modifications</span></code> section summarising
the important points of the new release.</p>
<p>They must end with a section pointing out <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Incompatibilities</span></code> and mentioning the
necessary actions before upgrading to this release.</p>
</section>
<section id="open-a-pull-request-for-the-new-release">
<h3>Open a Pull Request for the new release<a class="headerlink" href="#open-a-pull-request-for-the-new-release" title="Permalink to this heading">#</a></h3>
<p>The goal is to make all contributors aware of the new release, to check that no pending
modifications are worth being included and to review the release notes.</p>
<p>There should be no code modifications except updates of version informations in the
documentation. Once the pull request is approved and merged, the release may be built.</p>
</section>
<section id="build-the-release">
<h3>Build the release<a class="headerlink" href="#build-the-release" title="Permalink to this heading">#</a></h3>
<p>Now either go back to the draft release saved above, or start again the procedure,
but now finalising with the <code class="docutils literal notranslate"><span class="pre">Publish</span></code> button.</p>
<p>If all goes well, there will be a build of “Build and upload wheels and sdist”
associated with the tag <code class="docutils literal notranslate"><span class="pre">pyat-x.y.z</span></code>: on the <a class="reference external" href="https://github.com/atcollab/at/actions/workflows/build-python-wheels.yml">Github Actions page</a>. This build will have
‘tar.gz’ and ‘wheels’ downloads available.</p>
</section>
<section id="upload-the-release-to-pip">
<h3>Upload the release to <code class="docutils literal notranslate"><span class="pre">pip</span></code><a class="headerlink" href="#upload-the-release-to-pip" title="Permalink to this heading">#</a></h3>
<ul>
<li><p>Download the tar.gz and wheels files and unzip them into a directory <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code></p></li>
<li><p>Manually install at least one wheel to make sure that it has built correctly</p></li>
<li><p>Install Twine for uploading the files to PyPI. One way is to use
<a class="reference external" href="https://pypa.github.io/pipx/">pipx</a>. Once pipx installed, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pipx install twine  # or:
$ pipx upgrade twine
</pre></div>
</div>
</li>
<li><p>Use Twine to upload the files to PyPI. You will be prompted for your PyPI credentials:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ twine upload &lt;dir&gt;/*.whl
$ twine upload &lt;dir&gt;/*.tar.gz
</pre></div>
</div>
</li>
<li><p>Finally, check that the wheels are uploaded properly. You can use the same virtualenv:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install accelerator-toolbox
</pre></div>
</div>
</li>
</ul>
<p>Note that 46 different files were uploaded for pyat-0.0.4 covering different
platforms and architectures.</p>
<p>The configuration for this is in <code class="docutils literal notranslate"><span class="pre">.github/workflows/build-python-wheels.yml</span></code>.</p>
</section>
</section>
</section>
<section id="pyat-examples">
<h1>pyAT Examples<a class="headerlink" href="#pyat-examples" title="Permalink to this heading">#</a></h1>
<p>Please follow <code class="docutils literal notranslate"><span class="pre">&lt;at&gt;/pyat/README.rst</span></code> for installation instructions.
In these examples, we use the ring from <cite>hmba.mat</cite> found in <code class="docutils literal notranslate"><span class="pre">&lt;at&gt;/pyat/machine_data</span></code>;
however, they will also work on the <code class="docutils literal notranslate"><span class="pre">err.mat</span></code> ring if you want to be more
representative of a real accelerator.</p>
<section id="initialisation">
<h2>Initialisation:<a class="headerlink" href="#initialisation" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>Start Python within the virtual environment where PyAT in installed and
import <code class="docutils literal notranslate"><span class="pre">at</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd &lt;at&gt;
$ source venv/bin/activate
$ python
Python 2.7.3 (default, Nov  9 2013, 21:59:00)
[GCC 4.4.7 20120313 (Red Hat 4.4.7-3)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import at
&gt;&gt;&gt;
</pre></div>
</div>
</li>
<li><p>Load a pyAT ring from a .mat file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ring</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">load_lattice</span><span class="p">(</span><span class="s1">&#39;pyat/machine_data/hmba.mat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="basic-use">
<h2>Basic Use:<a class="headerlink" href="#basic-use" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>The lattice object is a Python interator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">ring</span><span class="p">:</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Viewing the first element in the ring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">RFCavity(&#39;RFC&#39;, 0.0, 187500.0, 352372212.4670127, 31, 6000000000.0, PassMethod=&#39;IdentityPass&#39;)</span>
</pre></div>
</div>
</li>
<li><p>Changing the pass method of an element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">PassMethod</span> <span class="o">=</span> <span class="s2">&quot;CavityPass&quot;</span>
</pre></div>
</div>
</li>
<li><p>Get the s position of the 10th element in the ring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">at</span><span class="o">.</span><span class="n">get_s_pos</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="go">array([3.4295565])</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="calculating-physics-data">
<h2>Calculating Physics Data:<a class="headerlink" href="#calculating-physics-data" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>Return the linear optics data at the first 5 elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">at</span><span class="o">.</span><span class="n">get_optics</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">refpts</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</li>
<li><p>Physics data functions can also be called as methods on the lattice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ring</span><span class="o">.</span><span class="n">find_orbit</span><span class="p">(</span><span class="n">refpts</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="index.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Welcome to pyAT’s documentation!</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="howto/Installation.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Installation</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   pyAT
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation">
     Installation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#usage">
     Usage
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-notes">
     Developer Notes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pyat-developer-notes">
   pyAT Developer Notes
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation-preparation">
     Installation preparation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#windows">
       Windows
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linux">
       Linux
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#source-download">
     Source download
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation-all-platforms">
     Installation (all platforms)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-results-with-matlab">
     Comparing results with Matlab
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#debugging">
     Debugging
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#releasing-a-version-to-pypi">
     Releasing a version to PyPI
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#release-procedure">
     Release procedure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decide-the-python-versions-that-should-be-supported-in-the-release">
       Decide the Python versions that should be supported in the release
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#determine-the-minimum-numpy-and-scipy-versions">
       Determine the minimum
       <code class="docutils literal notranslate">
        <span class="pre">
         numpy
        </span>
       </code>
       and
       <code class="docutils literal notranslate">
        <span class="pre">
         scipy
        </span>
       </code>
       versions:
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prepare-the-release-notes">
       Prepare the “Release notes”
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#open-a-pull-request-for-the-new-release">
       Open a Pull Request for the new release
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-the-release">
       Build the release
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#upload-the-release-to-pip">
       Upload the release to
       <code class="docutils literal notranslate">
        <span class="pre">
         pip
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pyat-examples">
   pyAT Examples
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialisation">
     Initialisation:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-use">
     Basic Use:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-physics-data">
     Calculating Physics Data:
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, ATCollab.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>